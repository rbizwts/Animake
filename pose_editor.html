<!DOCTYPE html>
<html lang="en">

<head>
    <title>index</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css?family=Questrial" rel="stylesheet">
    <meta name="description" content="Your description">
    <meta name="keywords" content="Your keywords">
    <meta name="author" content="Your name">
    <meta name="format-detection" content="telephone=no" />
    <!-- firebase -->
    <!--<script src="https://cdn.firebase.com/libs/firebaseui/1.0.0/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/1.0.0/firebaseui.css" />-->
    <script src="https://www.gstatic.com/firebasejs/4.1.2/firebase.js"></script>
    <!--<script src="firebase/config.js"></script>-->
    <!--<script src="firebase/providers.js"></script>-->
    <!-- end firebase -->

    <!--CSS-->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/reg_form.css">
    <link rel="stylesheet" href="fonts/font-awesome.css">
    <!--JS-->
    <script src="js/jquery.js"></script>
    <script src="js/jquery-migrate-1.2.1.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.mobilemenu.js"></script>
    <script src="js/jquery.equalheights.js"></script>
    <script src="js/sForm.js"></script>
    <script src="js/active.js"></script>
    <!--[if (gt IE 9)|!(IE)]><!-->
    <script src="js/wow/wow.js"></script>
    <script src="js/wow/device.min.js"></script>
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="BuildPose/UnityLoader.js"></script>
    <script>
        $(document).ready(function() {
            if ($('html').hasClass('desktop')) {
                new WOW().init();
            }
        });
    </script>
    <link rel="stylesheet" href="TemplateData/style.css">
    <link rel="stylesheet" href="css/poseeditor.css">


    <style>
        p1 {
            font-size: 35px;
        }
        
        p2 {
            font-size: 20px;
        }
    </style>
</head>

<body>

    <div class="main">
        <!--header-->
        <div class="container">
            <header class="clearfix">
                <nav class="navbar navbar-default navbar-static-top tm_navbar clearfix" role="navigation">
                    <ul class="nav sf-menu  clearfix">

                        <li class="sub-menu"><a href="index.html">Home</a>
                            <ul class="homeSub">
                                <li><a href="#">Animation</a>
                                    <ul class="bodysub">
                                        <li><a href="ARigger.html">Auto Rigger</a></li>
                                        <li><a href="repository.html">Repository</a></li>
                                        <li><a href="merger_tool.html">Merger Tool</a></li>
                                        <li><a href="pose_editor.html">Pose Editor</a></li>
                                    </ul>
                                </li>
                                <li><a href="#">3D Modelling</a>
                                    <ul class="bodysub">
                                        <li><a href="#">Yet To Launch</a></li>
                                    </ul>
                                </li>
                                <li><a href="#">Game maker</a>
                                    <ul class="bodysub">
                                        <li><a href="#">Yet To Launch</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="sub-menu"><a href="about.html">About</a></li>
                        <li> <a href="my_library.html">My Library</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </nav>
                <div class="follow_icon reposFollowIcon">
                    <div class="user-mail pull-right"></div>
                    <div class="log-Out" id="logOutBtn" type="button" onclick="logout()" class="lgbtn">Log-Out</div>
                    <div class="sign-in">
                        <!-- Trigger the modal with a button -->
                        <button type="button" class="btn btn-info btn-lg regB repositButton"><i class="fa fa-lock" aria-hidden="true"></i>Sign-in</button>
                    </div>
                </div>
            </header>
        </div>
    </div>


    <div class="wrapper">
        <!--content-->
        <div class="content" id="content">

            <div class="webgl-content">
                <div id="gameContainer" style="width: 850px; height: 600px"></div>
                <div align="center">
                    <div class="webgl-logo"></div>
                    <div class="fullscreen" onclick="gameInstance.SetFullscreen(1)"></div>

                    <br/>
                    <input id="anim_url" autocomplete="on" type="text" placeholder="animation url" value="http://35.197.25.101:8080/JSONAnimations/aim_pistol.json">
                    <button type="button" value="Load Animation" onclick="loadAnimFromUrl();">Load Animation</button>
                </div>
            </div>
        </div>
    </div>
    <div class="content">
    </div>
    <!--footer

    <footer>
        <div class="container">
            <figure><img src="img/fotterLogo.jpg" alt=""></figure>
        </div>

    </footer>-->

    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="reg">
                <img src="img/fotterLogo.png" alt="logo" class="img-logo img responsive">
                <hr>

                <div align="center">
                    <p1> <strong>Add Animations to <br>your Library</strong>
                    </p1>
                </div>
                <br>

                <div align="center">
                    <p2> <strong><a href="index.html" >Return to Home</a></strong>
                    </p2>
                </div>
            </div>

        </div>
    </div>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/tm-scripts.js"></script>
    <!--script src="./firebase_files/ie10-viewport-bug-workaround.js"></script-->
    <script src="js/firebaseAuth.js"></script>
    <script src="firebase/login.js"></script>
    <script src="firebase/register.js"></script>
    <script src="firebase/firebase-listener.js"></script>
    <script src="js/sForm.js"></script>
    <script src="js/blockUI.js"></script>
    <script type="text/javascript">
        function logout() {
            firebase.auth().signOut().then(function() {
                console.log('Signed Out');
            }, function(error) {
                console.error('Sign Out Error', error);
            });
            location.reload();
        }
        $(document).ready(function() {
            setTimeout(loadPage, 1500);
        });

        var animations_library = [];

        function loadAnimFromUrl(url) {
            console.log("Inside loadAnimFromUrl");
            console.log(url);
            $("#anim_url").attr("value", url);
            document.getElementById('anim_url').value = url;
            gameInstance.SendMessage('RTClipEditor', 'LoadAnimFromUrl', url);
        }

        function loadPage() {
            if (firebase.auth().currentUser) {
                // document.write('<script src="TemplateData/UnityProgress.js">\x3C/script>');
                // document.write('<script src="BuildPose/UnityLoader.js">\x3C/script>');
                var gameInstance = UnityLoader.instantiate("gameContainer", "BuildPose/Build12 (Our Template).json");
                console.log("Auth");
                //$.blockUI();
                var blocks = '';
                var k = 1;
                var completed = 1;
                var userId = firebase.auth().currentUser.uid;
                firebase.database().ref("usernames").child(userId).child("mylibrary").once("value", function(ss) {
                    var animations = ss.val();
                    if (!animations) {
                        alert("No items in library");
                        //$.unblockUI();
                    }
                    animations && Object.keys(animations).forEach(function(animKey) {
                        console.log(animations[animKey]);
                        animations_library.push(animations[animKey]);

                        firebase.storage().ref("jsonFiles").child(animations[animKey] + ".json").getDownloadURL().then(function(downloadUrl) {
                            console.log(downloadUrl);
                            //downloadUrls.push(downloadUrl);
                            console.log(typeof(downloadUrl));
                            $("#anim_url").attr("value", downloadUrl);
                            //document.getElementById('anim_url').value = downloadUrl;
                            console.log("HERE");
                            console.log(document.getElementById('anim_url').value);
                            gameInstance.SendMessage('RTClipEditor', 'LoadAnimFromUrl', downloadUrl);
                            //loadAnimFromUrl(downloadUrl);
                        });
                    });
                    // $.unblockUI();
                })
            } else {
                console.log("Not Auth");
                $('#myModal').modal({
                    backdrop: "static",
                    keyboard: false,
                    show: true
                });
            }
        }
    </script>
</body>

</html>